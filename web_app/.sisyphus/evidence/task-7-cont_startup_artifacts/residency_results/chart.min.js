(function(){
'use strict';
function _getCanvas(target){
  if(!target) return null;
  if(target instanceof HTMLCanvasElement) return target;
  if(target.canvas instanceof HTMLCanvasElement) return target.canvas;
  return null;
}
function _setupCanvas(canvas){
  var rect = canvas.getBoundingClientRect ? canvas.getBoundingClientRect() : {width:canvas.width,height:canvas.height};
  var dpr = window.devicePixelRatio || 1;
  var w = Math.max(1, Math.floor(rect.width || canvas.width || 600));
  var h = Math.max(1, Math.floor(rect.height || canvas.height || 240));
  if(canvas.width !== w*dpr || canvas.height !== h*dpr){
    canvas.width = w*dpr; canvas.height = h*dpr;
    canvas.style.width = w + 'px'; canvas.style.height = h + 'px';
  }
  var ctx = canvas.getContext('2d');
  ctx.setTransform(dpr,0,0,dpr,0,0);
  return {ctx:ctx,w:w,h:h};
}
function _num(x){ x = +x; return isFinite(x) ? x : 0; }
function _max(arr){
  var m = 0;
  for(var i=0;i<(arr||[]).length;i++){ var v = _num(arr[i]); if(v > m) m = v; }
  return m;
}
function _axes(ctx,w,h,pad){
  ctx.strokeStyle = 'rgba(205,214,227,0.25)';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(pad,pad);
  ctx.lineTo(pad,h-pad);
  ctx.lineTo(w-pad,h-pad);
  ctx.stroke();
}
function _renderBar(ctx,w,h,pad,labels,datasets){
  var values = (datasets[0] && datasets[0].data) ? datasets[0].data : [];
  var maxV = _max(values) || 1;
  var n = Math.max(1, values.length);
  var chartW = w - pad*2;
  var chartH = h - pad*2;
  var gap = 8;
  var barW = Math.max(2, (chartW - gap*(n-1)) / n);
  ctx.font = '11px system-ui, sans-serif';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'bottom';
  for(var i=0;i<n;i++){
    var v = _num(values[i]);
    var bh = chartH * (v / maxV);
    var x = pad + i*(barW+gap);
    var y = (h - pad) - bh;
    ctx.fillStyle = 'rgba(123,198,255,0.55)';
    ctx.fillRect(x,y,barW,bh);
    ctx.fillStyle = '#f5f7fb';
    ctx.fillText(String(v), x + barW/2, y - 2);
  }
}

function Chart(target, config){
  this.config = config || {};
  this.canvas = _getCanvas(target) || target;
  if(!this.canvas) return;
  this.render();
}
Chart.register = function(){ };
Chart.prototype.render = function(){
  var cfg = this.config || {};
  var type = String(cfg.type || 'bar');
  var data = cfg.data || {};
  var labels = data.labels || [];
  var datasets = data.datasets || [];
  if(!datasets || !datasets.length) return;
  var s = _setupCanvas(this.canvas);
  var ctx = s.ctx, w = s.w, h = s.h;
  ctx.clearRect(0,0,w,h);
  var pad = 32;
  _axes(ctx,w,h,pad);
  if(type === 'bar') _renderBar(ctx,w,h,pad,labels,datasets);
  else _renderBar(ctx,w,h,pad,labels,datasets);
};

window.Chart = window.Chart || Chart;
window.ChartDataLabels = window.ChartDataLabels || {};
})();
